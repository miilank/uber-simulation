<div class="min-h-screen flex flex-col bg-linear-to-b from-[#d6f4a2] to-[#f7f7f7] font-poppins">
      <!-- Centered form card -->
      <main class="flex-1 flex items-center justify-center px-4 py-8">
        <div class="w-full max-w-4xl bg-[#181818] rounded-[44px] px-8 py-10 md:px-16 md:py-12 shadow-xl">
          <div class="flex justify-center mb-8">
              <app-profile-picture
              [editable]="true"
              (avatarSelected)="setPicture($event)"
              class="w-30 h-30"></app-profile-picture>
          </div>

        <form #registerForm="ngForm" (ngSubmit)="registerForm.valid && onSubmit()" class="space-y-6">
        <!-- Row 1 -->
        <div class="grid grid-cols-4 gap-4">
            <!-- Name -->
            <div class="col-span-1 flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Name</label>
            <input
                type="text"
                name="firstName"
                [(ngModel)]="firstName"
                #firstNameCtrl="ngModel"
                required
                minlength="2"
                class="input-base w-full"
                placeholder="Name"
            />
            @if (firstNameCtrl.invalid && (firstNameCtrl.dirty || firstNameCtrl.touched)) {
                <p class="text-red-400 text-xs">
                @if (firstNameCtrl.errors?.['required']) { <span>Name is required.</span> }
                @if (firstNameCtrl.errors?.['minlength']) { <span>Name must be at least 2 characters.</span> }
                </p>
            }
            </div>

            <!-- Surname -->
            <div class="col-span-1 flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Surname</label>
            <input
                type="text"
                name="lastName"
                [(ngModel)]="lastName"
                #lastNameCtrl="ngModel"
                required
                minlength="2"
                class="input-base w-full"
                placeholder="Surname"
            />
            @if (lastNameCtrl.invalid && (lastNameCtrl.dirty || lastNameCtrl.touched)) {
                <p class="text-red-400 text-xs">
                @if (lastNameCtrl.errors?.['required']) { <span>Surname is required.</span> }
                @if (lastNameCtrl.errors?.['minlength']) { <span>Surname must be at least 2 characters.</span> }
                </p>
            }
            </div>

            <!-- Email -->
            <div class="col-span-2 flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Email</label>
            <input
                type="email"
                name="email"
                [(ngModel)]="email"
                #emailCtrl="ngModel"
                required
                email
                class="input-base w-full"
                placeholder="Email"
            />
            @if (emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)) {
                <p class="text-red-400 text-xs">
                @if (emailCtrl.errors?.['required']) { <span>Email is required.</span> }
                @if (emailCtrl.errors?.['email']) { <span>Please enter a valid email address.</span> }
                </p>
            }
            </div>
        </div>

        <!-- Row 2 -->
        <div class="grid grid-cols-2 gap-4">
            <!-- Address -->
            <div class="flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Address</label>
            <input
                type="text"
                name="address"
                [(ngModel)]="address"
                #addressCtrl="ngModel"
                required
                minlength="5"
                class="input-base w-full"
                placeholder="Address"
            />
            @if (addressCtrl.invalid && (addressCtrl.dirty || addressCtrl.touched)) {
                <p class="text-red-400 text-xs">
                @if (addressCtrl.errors?.['required']) { <span>Address is required.</span> }
                @if (addressCtrl.errors?.['minlength']) { <span>Address must be at least 5 characters.</span> }
                </p>
            }
            </div>

            <!-- Phone Number -->
            <div class="flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Phone Number</label>
            <input
                type="tel"
                name="phone"
                [(ngModel)]="phone"
                #phoneCtrl="ngModel"
                required
                pattern="[+]?[0-9\\s\\-\\(\\)]{10,}"
                class="input-base w-full"
                placeholder="Phone number"
            />
            @if (phoneCtrl.invalid && (phoneCtrl.dirty || phoneCtrl.touched)) {
                <p class="text-red-400 text-xs">
                @if (phoneCtrl.errors?.['required']) { <span>Phone number is required.</span> }
                @if (phoneCtrl.errors?.['pattern']) { <span>Please enter a valid phone number.</span> }
                </p>
            }
            </div>
        </div>


        <!-- Vehicle -->
        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-2">
                <label class="text-white font-normal font-poppins">Vehicle model</label>
                <input
                    type="text"
                    name="vehicleModel"
                    [(ngModel)]="vehicleModel"
                    #modelCtrl="ngModel"
                    required
                    class="input-base w-full"
                    placeholder="Vehicle model"
                />
                @if (modelCtrl.invalid && (modelCtrl.dirty || modelCtrl.touched)) {
                    <p class="text-red-400 text-xs">
                    @if (modelCtrl.errors?.['required']) { <span>Vehicle model is required.</span> }
                    </p>
                }
            </div>

            <div class="flex flex-col gap-2">
                <label class="text-white font-normal font-poppins">Vehicle type</label>
                <div class="relative">
                    <select
                    class="w-full input-base"
                    [(ngModel)]="vehicleType"
                    #typeCtrl="ngModel"
                    required
                    name="vehicleType"
                    >
                    @for (v of vehicleTypes; track $index) {
                        <option>{{ v }}</option>
                    }
                    </select>

                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none" width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                @if (typeCtrl.invalid && (typeCtrl.dirty || typeCtrl.touched)) {
                    <p class="text-red-400 text-xs">
                    @if (typeCtrl.errors?.['required']) { <span>Vehicle type is required.</span> }
                    </p>
                }
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">Number of passengers</label>
            <input
                type="number"
                name="passengers"
                [(ngModel)]="passengers"
                #passengersCtrl="ngModel"
                min="1"
                class="input-base w-full"
                placeholder="Passengers"
            />
            @if (passengersCtrl.invalid && (passengersCtrl.dirty || passengersCtrl.touched)) {
                    <p class="text-red-400 text-xs">
                    @if (passengersCtrl.errors?.['min']) { <span>Vehicle must carry at least one passenger.</span> }
                    </p>
                }
            </div>

            <div class="flex flex-col gap-2">
            <label class="text-white font-normal font-poppins">License plate</label>
            <input
                type="text"
                name="licensePlate"
                [(ngModel)]="licensePlate"
                #licenseCtrl = "ngModel"
                required
                class="input-base w-full"
                placeholder="License plate"
            />
            @if (licenseCtrl.invalid && (licenseCtrl.dirty || licenseCtrl.touched)) {
                    <p class="text-red-400 text-xs">
                    @if (licenseCtrl.errors?.['required']) { <span>License is required.</span> }
                    </p>
                }
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div>
            <button
                type="button"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:opacity-80 transition-opacity"
                (click)="pets = !pets"
            >
                <div class="flex items-center gap-3">
                <span class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center border border-gray-300"
                        [ngClass]="{'bg-app-accent': pets, 'bg-white': !pets}">
                    @if(pets){
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M20 6L9 17L4 12" stroke="#111111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    }
                </span>

                <span class="text-white font-normal font-poppins">Pet friendly</span>
                </div>
            </button>
            </div>

            <div>
            <button
                type="button"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:opacity-80 transition-opacity"
                (click)="infants = !infants"
            >
                <div class="flex items-center gap-3">
                <span class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center border border-gray-300"
                        [ngClass]="{'bg-app-accent': infants, 'bg-white': !infants}">
                    @if (infants) {
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M20 6L9 17L4 12" stroke="#111111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    }
                </span>

                <span class="text-white font-normal font-poppins">Baby friendly</span>
                </div>
            </button>
            </div>
        </div>

        <!-- Register button -->
        <div class="pt-4">
            <button
            type="submit"
            [disabled]="registerForm.invalid || isSubmitting"
            class="w-full bg-app-accent text-black text-sm font-normal font-poppins py-3 rounded-full hover:bg-app-accent-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
            @if (isSubmitting) {
                <span>Registering...</span>
            } @else {
                <span>Register</span>
            }
            </button>
        </div>
        </form>
        </div>


        @if (registrationSuccess) {
        <div class="fixed inset-0 z-50 flex items-center justify-center">
          <!-- Backdrop -->
          <div class="absolute inset-0 bg-black/50"></div>

          <!-- Modal -->
          <div class="relative z-10 w-full max-w-sm bg-white rounded-2xl shadow-xl p-6">
            <div class="text-center space-y-4">
              <div class="flex justify-center">
                <svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <h2 class="text-lg font-semibold text-gray-900">Registration Successful!</h2>
              <p class="text-sm text-gray-600">
                Activation email sent to <span class="font-medium">{{ email }}.</span>
              </p>
              <button
                (click)="closeSuccessPopup()"
                class="mt-4 px-6 py-2 rounded-full text-sm bg-app-accent text-app-dark hover:bg-app-accent-dark transition"
              >
                Go to dashboard
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Error Message -->
      @if (registrationError) {
        <div class="fixed top-4 right-4 z-50 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg max-w-md">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="flex-1">
              <p class="text-sm text-red-800">{{ registrationError }}</p>
            </div>
            <button (click)="registrationError = null" class="text-red-500 hover:text-red-700">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
      }
      </main>
    </div>