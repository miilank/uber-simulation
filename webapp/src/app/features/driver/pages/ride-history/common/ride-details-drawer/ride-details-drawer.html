@if (open && ride) {
  <!-- backdrop -->
  <div
    class="fixed inset-0 bg-black/50 z-50"
    (click)="onBackdropClick()">
  </div>

  <!-- right panel -->
  <aside
    class="fixed top-0 right-0 h-full w-105 max-w-[95vw] bg-white z-50 shadow-2xl
           flex flex-col font-poppins">
    <!-- header -->
    <div class="px-6 pt-5 pb-4 border-b border-gray-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <h3 class="text-lg">Ride Details</h3>

          @if (ride.status === 'COMPLETED') {
            <span class="inline-flex items-center h-6 px-3 rounded-full bg-green-100 text-green-700 text-xs">
            Completed
          </span>
          } @else if (ride.status === 'STOPPED') {
            <span class="inline-flex items-center h-6 px-3 rounded-full bg-yellow-100 text-yellow-700 text-xs">
            Stopped Early
          </span>
          } @else if (ride.status === 'CANCELLED') {
            <span class="inline-flex items-center h-6 px-3 rounded-full bg-red-100 text-red-700 text-xs">
            Cancelled
          </span>
          }
        </div>

        <button
          type="button"
          class="w-9 h-9 rounded-full hover:bg-gray-100 flex items-center justify-center cursor-pointer"
          (click)="onClose()"
          aria-label="Close">
          ✕
        </button>
      </div>
    </div>

    <!-- content -->
    <div class="px-6 py-5 overflow-auto flex-1">
      <!-- Route -->
      <div class="mb-6">
        <h4 class="text-sm mb-3">Route</h4>

        <div class="flex items-start gap-3 mb-3">
          <div class="w-2.5 h-2.5 rounded-full bg-green-600 mt-1"></div>
          <div>
            <div class="text-[11px] text-gray-500">Pickup</div>
            <div class="text-sm text-gray-900">{{ ride.from }}</div>
          </div>
        </div>

        @for (s of routeStops; track s.label) {
          <div class="flex items-start gap-3 mb-3">
            <div class="w-2.5 h-2.5 rounded-full bg-white mt-1"></div>
            <div>
              <div class="text-[11px] text-gray-500">{{ s.label }}</div>
              <div class="text-sm text-gray-900">{{ s.address }}</div>
            </div>
          </div>
        }

        <div class="flex items-start gap-3">
          <div class="w-2.5 h-2.5 rounded-full bg-red-600 mt-1"></div>
          <div>
            <div class="text-[11px] text-gray-500">Destination</div>
            <div class="text-sm text-gray-900">{{ ride.to }}</div>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="mb-6">
        <h4 class="text-sm mb-3">Timeline</h4>

        <div class="grid grid-cols-2 gap-y-2 text-sm">
          <div class="text-gray-500">Start time:</div>
          <div class="text-right text-gray-900">{{ startDateTime }}</div>

          <div class="text-gray-500">End time:</div>
          <div class="text-right text-gray-900">{{ endDateTime }}</div>

          <div class="text-gray-500">Duration:</div>
          <div class="text-right text-gray-900">{{ duration }}</div>
        </div>
      </div>

      <!-- Passengers -->
      <div class="mb-6">
        <h4 class="text-sm mb-3">Passengers</h4>

        <div class="flex flex-col gap-2">
          @for (p of passengers; track p.email) {
            <div class="bg-gray-50 rounded-xl px-4 py-3 flex items-center justify-between">
              <div class="text-sm text-gray-900">{{ p.name }}</div>
              <div class="text-xs text-gray-500">{{ p.email }}</div>
            </div>
          }
        </div>
      </div>

      <!-- Payment -->
      <div class="mb-6">
        <h4 class="text-sm mb-3">Payment</h4>

        <div class="bg-gray-50 rounded-xl px-4 py-4 flex items-center justify-between">
          <div class="text-sm text-gray-500">Total cost:</div>
          <div class="text-base text-gray-900">€{{ rideDetails?.totalPrice?.toFixed(2) || '0.00' }}</div>
        </div>
      </div>

      <!-- Cancellation (only if cancelled) -->
      @if (ride.status === 'CANCELLED') {
        <div class="mb-6">
          <h4 class="text-sm mb-3">Cancellation</h4>

          <div class="border border-red-100 bg-red-50 rounded-xl px-4 py-4">
            <div class="grid grid-cols-2 gap-y-2 text-sm">
              <div class="text-gray-500">Cancelled by:</div>
              <div class="text-right text-gray-900">{{ ride.cancelledBy }}</div>

              <div class="text-gray-500">Reason:</div>
              <div class="text-right text-gray-900">{{ cancelReason }}</div>

              <div class="text-gray-500">Time:</div>
              <div class="text-right text-gray-900">{{ cancelTime }}</div>
            </div>
          </div>
        </div>
      }
      @if (ride.status === 'STOPPED') {
        <div class="mb-6">
          <h4 class="text-sm mb-3">Early Stop</h4>

          <div class="border border-yellow-100 bg-yellow-50 rounded-xl px-4 py-4">
            <div class="grid grid-cols-2 gap-y-2 text-sm">
              <div class="text-gray-500">Stopped at:</div>
              <div class="text-right text-gray-900">{{ stoppedLocation }}</div>

              <div class="text-gray-500">Stop time:</div>
              <div class="text-right text-gray-900">{{ stoppedTime }}</div>
            </div>
          </div>
        </div>
      }
      <!-- Safety -->
      <div class="mb-2">
        <h4 class="text-sm mb-3">Safety</h4>

        <div class="bg-gray-50 rounded-xl px-4 py-4">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm text-gray-500">Panic triggered:</div>

            @if (panicYes) {
              <span class="inline-flex items-center h-6 px-3 rounded-full bg-orange-100 text-orange-700 text-xs">
                Yes
              </span>
            } @else {
              <span class="inline-flex items-center h-6 px-3 rounded-full bg-gray-200 text-gray-700 text-xs">
                No
              </span>
            }
          </div>

          @if (panicYes) {
            <div class="flex items-center justify-between text-sm">
              <div class="text-gray-500">Timestamp:</div>
              <div class="text-right text-gray-900">{{ panicTimestamp }}</div>
            </div>
          }
        </div>
      </div>

      <!-- Inconsistencies -->
      @if (inconsistencies.length > 0) {
        <div class="mb-2">
          <h4 class="text-sm mb-3">Passenger Reports</h4>

          <div class="flex flex-col gap-3">
            @for (inc of inconsistencies; track inc.passengerId) {
              <div class="border border-orange-100 bg-orange-50 rounded-xl px-4 py-4">
                <div class="flex items-start justify-between mb-2">
                  <div class="text-sm font-medium text-gray-900">{{ inc.passengerName }}</div>
                  <div class="text-xs text-gray-500">
                    {{ formatInconsistencyDate(inc.createdAt) }}
                  </div>
                </div>
                <div class="text-sm text-gray-700">{{ inc.description }}</div>
              </div>
            }
          </div>
        </div>
      }
    </div>

    <!-- footer -->
    <div class="px-6 py-5 border-t border-gray-100">
      <button
        type="button"
        class="w-full h-11 rounded-xl bg-neutral-900 text-white text-sm hover:bg-neutral-800 transition-colors cursor-pointer"
        (click)="onClose()">
        Close
      </button>
    </div>
  </aside>
}
